Hacer el Admixture:
Set_O    + Set_F  + Set_K  + Set_L  + Set_M (a SACE)
217World + 171YMX + 29SAM1 + 10SAM2 + 16SAM3

OpenRefine => Create new column Admixture1 based on column Nombre_Fastq by filling 469 rows with grel:if(or(cells['Set_O'].value == "1", cells['Set_F'].value == "1", cells['Set_K'].value == "1", cells['Set_L'].value == "1", cells['Set_M'].value == "1"), value, 0) 

scp "D:/Dropbox/Posdoc/Articulo Estructura SACE/YMXdomesticated_SACEddd_PopGen/Tables/SampleSheet_SACE421_Admixture1.csv" javelar@dna.lavis.unam.mx:/mnt/Timina/lmorales/Public/ymez/data/metadata

cd /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/
mkdir SACE421_Admixture1
cd SACE421_Admixture1/

cd /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SAPA127/admixture
cp Remove_LD_from_VCF_SAPA127.sge ../..
cd ../..
mv Remove_LD_from_VCF_SAPA127.sge SACE421_Admixture1/
mv Remove_LD_from_VCF_SAPA127.sge Remove_LD_from_VCF_SACE421.sge

vim Remove_LD_from_VCF_SACE421.sge # Cambiar la línea #$ -e; #$ -o; 


mv Matrix!
# tengo que hacer la matriz primero!
#### 06_genotyping HACER MULTIVCF
qlogin
cd  /mnt/Timina/lmorales/Public/ymez/bin/scripts/06_genotyping
module load python37/3.7.0
python3.7 genotyping_and_filtering.py   -s /mnt/Timina/lmorales/Public/ymez/data/metadata/SampleSheet_SACE421_Admixture1.csv  -r /mnt/Timina/lmorales/Public/ymez/data/metadata/ref_only_SACE.txt -m .1
exit
cd  /mnt/Timina/lmorales/Public/ymez/bin/SGE/06_genotyping/
mv javelar_SH_getSNPmatrix.sh javelar_SH_getSNPmatrix_from_SACE_SACE421.sh

## CAMBIAR el nombre del getmatrix!
mv get_SACE_SNPmatrix_from_SACE.sge  get_SACE_SNPmatrix_from_SACE_SACE421.sge 
vim javelar_SH_getSNPmatrix_from_SACE_SACE421.sh # cambié el nombre del sge que va a mandar correr
vim  get_SACE_SNPmatrix_from_SACE_SACE421.sge # cambie output de .err y .out

bash javelar_SH_getSNPmatrix_from_SACE_SACE421.sh # 18:57


qsub Remove_LD_from_VCF_SACE421.sge /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SACE421_Admixture1/Matrix.vcf 500 100 .15

qlogin
cd /mnt/Timina/lmorales/Public/ymez/bin/scripts/10_admixture
module load python37/3.7.0
python3.7 SendAdmixtureSGEs.py --dirbed /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SACE421_Admixture1 --bed Matrix_LDPrune_500_100_.15.bed --out /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SACE421_Admixture1/out --minS 1 --maxS 5 --minK 1 --maxK 30 --setname SACE421
exit
# python3.7 SendAdmixtureSGEs.py --dirbed /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SACE421_Admixture1 --bed Matrix_LDPrune_500_100_.15.bed --out /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SACE421_Admixture1/out --minS 1 --maxS 5 --minK 31 --maxK 35 --setname SACE421

cd /mnt/Timina/lmorales/Public/ymez/bin/SGE/10_admixture
bash javelar_admixture_K1-30_S1-5_SACE421.sh

### Generar archivo CV
cd /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SACE421_Admixture1/out
grep -h CV /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SACE421_Admixture1/out/log*.out|awk -F "=|:" '{print $2"\t"$3}' | sed 's/)//g'| sort -n #> Values_CV_SACE421.txt
less Values_CV_SACE421.txt


cd /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SACE421_Admixture1/out
### PONG
rm Pong_mfile_SACE421.txt
for seed in {1..2}; 
do   
  for k in {10..12};   do     
    echo -e "K${k}s${seed}\t${k}\tMatrix_LDPrune_500_100_.15_S${seed}_K${k}.${k}.Q" >> Pong_mfile_SACE421.txt # Pong_mfile_k11-13_s1-10.txt   
  done; 
done
mv Pong_mfile_SACE421.txt Pong_mfile_SACE421_K10-K12.txt

### IND2POP
 cut -d',' -f7 /mnt/Timina/lmorales/Public/ymez/data/metadata/Ind2Pop_SACE421.csv >> SACE421_ind2pop.txt

### CORRER PONG
qlogin
cd /mnt/Timina/lmorales/Public/ymez/tmp/06_genotyping/trees/SAPA146/admixture/out
/usr/bin/pong -m Pong_mfile_SACE421_K10-K12.txt -i SACE421_ind2pop.txt -p 5000 # VERSIÓN SIMPLE
/usr/bin/pong -m Pong_mfile_SACE421_K10-K12.txt -i SACE421_ind2pop.txt -p 5000 -n  Order.Clades.csv # ordenada
/usr/bin/pong -m Pong_mfile_SACE421_K10-K12.txt -i SACE421_ind2pop.txt -p 5000 -n  Order.Clades.csv --color_list colores_pong


## en otra terminal:  ssh -L 4999:compute-00-11:5000 javelar@dna.lavis.unam.mx -Y # 00-11 es el número del qlogin
## en el navegador   http://localhost:4999/

 Matrix_LDPrune_500_100_.15.bed
#PCA 
#con plink ### NO JALÓ
# filter out SNPs and individuals based on minor allele frequency, missing genotype rate, and Hardy-Weinberg equilibrium, respectively. For example:
plink --bfile Matrix_LDPrune_500_100_.15 --maf 0.01 --geno 0.05 --hwe 0.00001 --make-bed --out Matrix_LDPrune_500_100_.15_QC 
#Perform PCA 
plink --bfile Matrix_LDPrune_500_100_.15_QC --pca --out Matrix_LDPrune_500_100_.15_PCA

#con plink2
module load plink2/2.00a2.3
plink2 --bfile Matrix_LDPrune_500_100_.15 --pca 10


